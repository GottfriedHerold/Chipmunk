% !TEX root = ../main.tex

\section{Key-Homomorphic One-Time Signatures}\label{sec:otms}

In this section, we define and instantiate key-homomorphic one-time signatures, which are a weak form of a digital signature scheme that is only guaranteed to be unforgeable, if at most one signature is published under any given public key.
A one-time signature is called key-homomorphic, if the linear combination of separate signatures for the same message verifies under the linear combination of the corresponding public keys.

Our definitions again follow the definitions of \cite{CCS:FleSimZha22} closely, but are incomparable just as in \autoref{sec:veccom}.
As with the vector commitments, we have the stronger requirement that the homomorphism works for any individually verifying signature, not just honestly created ones.
But, this homomorphism is allowed to have a noticeable correctness error.

The construction presented in this section is a modification of the construction of \cite{CCS:FleSimZha22}, which itself was a modification of the one-time signature schemes by Boneh and Kim~\cite{BonKim2020} and Lyubashevsky and Micciancio~\cite{TCC:LyuMic08}.

% % \gnote{Should define key and signature spaces as $\ring$-modules rather than talking about $\siglen$ and $\opklen$ (and say that what those modules are for our cases), similarly to what HVC def does. The current definition talks about arbitrary rings, for which we did does not define $\ring_q$.}
\begin{definition}[Key-Homomorphic One-Time Signature]\label{def:hots}
  Let $\ring$ be a ring. Let $\modopk$ and $\modsig$ be $\ring$-modules denoting the spaces where the public keys and signatures are from.
  A key-homomorphic one-time signature scheme (KOTS) over $\ring$ with public key space $\modopk$ and signatures from $\modsig$
%   $\opklen$ and signature length $\siglen$ 
  is defined by six PPT algorithms $\hots=(\setup,\kgen,\sign,\iverify, \sverify, \wverify)$.
  \begin{description}
    \item[$\params\gets\setup(\secparam)$] The setup algorithm takes as input the security parameter and outputs public parameters.
    \item[$(\osk,\opk) \gets \kgen(\params)$] The key generation algorithm takes as input the public parameters and outputs a key pair with $\opk\in\modopk$.
    \item[$\vec{\sigma} \gets \sign(\params,\osk,m)$] The signing algorithm takes as input the public parameters, a one-time signing key, and a message and outputs a signature $\sigma\in\modsig$.
    \item[$b\gets \iverify(\params,\opk,m,\sigma)$] The individual verification algorithm takes as input the public parameters, a verification key, a message, and a candidate signature and outputs a bit indicating acceptance/rejection.
    \item[$b\gets \sverify(\params,\opk,m,\sigma)$] The strong verification algorithm has the same input and output domains as the individual verification algorithm.
    \item[$b\gets \wverify(\params,\opk,m,\sigma)$] The weak verification algorithm has the same input and output domains as the individual verification algorithm.
  \end{description}
\end{definition}
Note that for us, we will always have $\ring = \ZZ[X]/\langle X^n+1\rangle$ for $n$ a power of two and $\modsig = \ring_{q'}^\siglen$, $\modopk = \ring_{q'}^\opklen$ for some prime $q'$.

\begin{definition}[Individual Correctness]
Let $\hots$ be a key-{}homo\-morphic one-time signature scheme.
$\hots$ is individually correct, if for all security parameters $\secpar\in\NN$, parameters $\params \gets \setup(\secparam)$, key pairs $(\osk,\opk) \gets \kgen(\params)$, messages $m\in\bin^*$, and signatures $\vec{\sigma} \gets \sign(\params,\osk,m)$ it holds that
\[
  \iverify(\params,\opk,m,\sigma)=1\enspace.
\]
\end{definition}

We require that individually verifying signatures can be homomorphically aggregated by computing a random linear combination of them.
Such aggregated signatures should still \emph{strongly} verify with high probability over the choice of the random linear combination.

\begin{definition}[Probabilistic Homomorphism]
  Let $\hots$ be a one-time signature scheme over a ring $\ring$ with public key space $\modopk$ and signatures from $\modsig$.
  Let $\rho \in \NN$, error bound $0\leq \errorbound \leq 1$ and $W\subseteq \ring$.
  $\hots$ is $(\rho,W,\errorbound)$-probabilistically homomorphic, if 
  for all security parameters $\secpar\in\NN$, number of aggregated signatures $\ell\in[\rho]$, parameters $\params \gets \setup(\secparam)$, public keys $\opk^i \in \modopk$, messages $m\in\bin^*$ and signatures $\vec{\sigma}^i\in\modsig$ with $\iverify(\params,\opk^i,m,\vec{\sigma}^i)$ it holds that
  \begin{align*}
    &\Pr\mleft[
      w^1,\dots,w^\ell\gets W
      \colon
      \sverify(\params,\sum_{i=1}^{\ell}w^i\cdot\opk^i,m,\sum_{i=1}^{\ell}w^i\cdot\vec{\sigma}^i) = 1
    \mright] \\
    &\geq 1-\errorbound\enspace.
  \end{align*}
\end{definition}

As with the vector commitments from the previous section, we additionally require that a further limited homomorphism still holds, even for maliciously \emph{aggregated} signatures.
For any two, even maliciously generated, signatures that \emph{strongly} verify under potentially maliciously generated public keys, their difference will still \emph{weakly} verify.

\begin{definition}[Robust Homomorphism]
  \label{def:malhomhots}
  Let $\hots$ be a key-{}homo\-morphic one-time signature scheme over a ring $\ring$ with public key space $\modopk$ and signatures from $\modsig$.
  $\hots$ is robustly homomorphic if for all security parameters $\secpar\in\NN$, public parameters $\params\gets\setup(\secparam)$, messages $m\in\bin^*$, (possibly malformed) public keys $\opk^0,\opk^1 \in \modopk$, and (possibly malformed) signatures $\vec{\sigma}^0,\vec{\sigma}^1\in\modsig$ with
  \[
    \sverify(\params,\opk^0, m,\vec{\sigma}^0)=1 \quad \text{and} \quad \sverify(\params,\opk^1, m,\vec{\sigma}^1)=1
  \]
  it holds that
  $
    \wverify(\params,\opk^0-\opk^1, m,(\vec{\sigma}^0-\vec{\sigma}^1))=1.
  $
\end{definition}

The following definition of a multi-user version of (one-time) existential unforgeability under rerandomized keys is taken directly from \cite{CCS:FleSimZha22}.

\begin{definition}[Multi-User Existential Unforgeability under Rerandomized Keys]
  A $(\rho,W,\varepsilon)$-homomorphically correct KOTS is $W'$-existentially unforgeable under rerandomized keys (EUF-RK), if for all security parameters $\secpar$, any $T=\poly\in\NN$ and all stateful PPT algorithms $\adv$ it holds that
  \[
    \begin{aligned}
    &\Pr\mleft[
      \begin{aligned}
      \params \gets \setup(\secparam);\\
      \forall i \!\in\! [T]\ldotp (\osk_i,\opk_i) \gets \kgen(\params);\\
      \mleft(
      \begin{aligned}
      &i^*\!,m^*\!,\\&\sigma^*\!,w^*
      \end{aligned}
      \mright) 
      \gets \adv^{\widetilde\sign(\cdot,\cdot)}(\params,\vec{\opk})\\
%      \sigma \gets \sign(\params,\osk,m);\\
%      (m^*,\sigma^*,w_0^*,w_1^*) \gets \adv(\sigma)\\
      \end{aligned}\!\colon\!\!
      \begin{aligned}
      &\wverify(\params,w^{*\!}\opk_{i^*},m^*\!\!,\sigma^*) = 1\\
      &\land m^*\not\in Q_{i^*} \land \abs{Q_{i^*}}\leq 1\\
      &\land w^* \in W'
      \end{aligned}
    \mright]\\
    &\leq \negl\enspace,
    \end{aligned}
  \]
  where the oracle $\widetilde\sign(\cdot,\cdot)$ is defined as $\widetilde\sign(i,m) := \sign(\osk_i,m)$ and $Q_i$ denotes the set of messages for which a signing query with index $i$ has been made.
\end{definition}

\begin{figure}
\centering
\begin{pcvstack}[center,boxed]
\begin{pchstack}[center]
  \procedure{$\setup(\secparam)$}{\\[-1.2em]
    \vec{a} \gets \ring_{q'}^\otspkkeylen\\
    \pcreturn \vec{a}
  }
  \pchspace
  \procedure{$\kgen(\params)$}{\\[-1.2em]
    \vec{s}_0 \gets \ball{\varphi}{q'}^\otspkkeylen\\
    \vec{s}_1 \gets \ball{\varphi\cdot\alpha_H}{q'}^{\otspkkeylen}\\
    v_0 := \vec{a}^\transpose\cdot \vec{s}_0\\
    v_1 := \vec{a}^\transpose\cdot \vec{s}_1\\
    \pcreturn ((\vec{s}_0,\vec{s}_1),(v_0,v_1))
  }
  \pchspace
  \procedure{$\sign(\params,\osk,m)$}{\\[-1.2em]
    \pcparse \osk \pcas (\vec{s}_0,\vec{s}_1)\\
    \vec{\sigma} := \vec{s}_0\cdot H(m)+\vec{s}_1\\
    \pcreturn \vec{\sigma}
  }
  \end{pchstack}
  \pchspace
  \begin{pchstack}
  \begin{pcvstack}
  \procedure{$\iverify(\params,\opk,m,\vec{\sigma})$}{\\[-1.2em]
    \pcreturn \verify(\params,\opk,m,\vec{\sigma},2\varphi\alpha_H)
  }
  \pcvspace
  \procedure{$\sverify(\params,\opk,m,\vec{\sigma})$}{\\[-1.2em]
    \pcreturn \verify(\params,\opk,m,\vec{\sigma},\beta_\sigma)
  }
  \pcvspace
  \procedure{$\wverify(\params,\opk,m,\vec{\sigma})$}{\\[-1.2em]
    \pcreturn \verify(\params,\opk,m,\vec{\sigma},2\beta_\sigma)
  }
  \end{pcvstack}
  \pchspace
  \procedure{$\verify(\params,\opk,m,\vec{\sigma},\beta')$}{\\[-1.2em]
    \pcparse \opk \pcas (v_0,v_1)\\
    \pcif \norm{\vec{\sigma}} > \beta'\\
    \quad \pcreturn 0\\
    \pcif \vec{a}^\transpose\cdot \vec{\sigma} \neq v_0\cdot H(m) + v_1\\
    \quad \pcreturn 0\\
    \pcreturn 1
  }
\end{pchstack}
\end{pcvstack}
\caption{%
Description of our key-homomorphic one-time signature scheme $\otschip$ from \autoref{def:our_ots}.
$H$ is a collision-resistant hash function mapping bit-strings to $\tern_{\alpha_H}$.
Our key space is $\modopk = \ring_{q'}^{2}$.
The signature space is $\modsig = \ring_{q'}^\otspkkeylen$.
}
\label{fig:otsconstruction}
\end{figure}

\autoref{fig:otsconstruction} shows the construction of the KOTS we will use.
The construction is almost identical to the construction from \cite{CCS:FleSimZha22} but differs from it in its choice of the ball from which the secret keys are chosen.
Specifically, the components of the secret keys are allowed to have a larger infinity norm.
This is beneficial, because the security proof partially relies on fact that the function mapping secret keys to public keys and signatures is highly compressing.
With a larger secret key-space the compression ratio increases, allowing us to reduce the size of other parameters, ultimately decreasing the size of the signatures.

\begin{definition}\label{def:our_ots}
Let $n, q', \alpha_H, \varphi, \otspkkeylen, \beta_\sigma$ be integers and $H$ be a hash function mapping bit strings to $\tern_{\alpha_H}$.
Let $\ring = \defring$ and $\ring_{q'} = \defringqq$.
% 
% \smallskip\noindent
We define $\otschip = (\setup, \kgen, \sign,\allowbreak \iverify, \sverify, \wverify)$ as the key-homomorphic one-time scheme over $\ring$ as in \autoref{fig:otsconstruction}.
Its public key space is $\modopk = \ring_{q'}^{2}$ and its signature space is $\modsig = \ring_{q'}^\otspkkeylen$.
\end{definition}


\begin{theorem}\label{theo:kots}
Let $\secpar, \alpha_w$, $\alpha_H$, $\varphi$, $\otspkkeylen$, $\rho$, $\beta_\sigma$, $n$, $q'$ be integers and $0 < \errorbound < 1$ such that $q'$ is prime and $q' > 16\alpha_w\alpha_H\varphi$, $n$ is a power of two and there exists $\delta$ with
\begin{align*}
2^{2\secpar} & \leq \abs{\tern_{\alpha_H}} \leq 2^{2\secpar+\delta},\\
\beta_\sigma & \geq 4\varphi\alpha_H\sqrt{\tfrac{1}{2}\alpha_w\rho \cdot \ln\tfrac{2n\otspkkeylen}{\errorbound} }\\
\otspkkeylen & \geq((3\secpar+\delta)/n+\log_2q')\log^{-1}_2(\varphi+\tfrac{1}{2})\enspace.
\end{align*}
Let $H\colon\, \bin^* \to \tern_{\alpha_H}$ be a hash function.
Let $W' = \{w_0-w_1\mid w_0,w_1\in\tern_{\alpha_w} \land w_0\neq w_1\}$.
If the $\sis_{\ring,q',\otspkkeylen,2\beta_\sigma+4\alpha_w\alpha_H\varphi}$ problem is hard and $H$ is collision resistant,
then the construction $\otschip$ from \autoref{fig:otsconstruction} is an individually correct, $(\rho,\tern_{\alpha_w},\varepsilon)$-probabilistically homomorphic, robustly homomorphic KOTS that is $W'$-multi-user existentially unforgeable under rerandomized keys.
\end{theorem}
Due to space constraints the proof of \autoref{theo:kots} is ommitted.
The proof follows the same ideas as the proof in \cite{CCS:FleSimZha22} with the neccessary modifications.
The proof can be found in the full version~\cite{fullversion} of this work.
%\begin{proof}
%The theorem follows from \autoref{lem:kots_ind_correct}, \ref{lem:kots_correct}, \ref{lem:kots_homomorphic}, and \ref{lem:kots_sis}.
%\end{proof}

%The following four lemmas state that our construction satisfies the desired homomorphic properties and that it is unforgeable.
%\begin{lemma}\label{lem:kots_ind_correct}
%Let $\secpar, \alpha_w$, $\alpha_H$, $\varphi$, $\otspkkeylen$, $\rho$, $\beta_\sigma,n,q'$ be positive integers, such that $n$ is a power of two, $q'$ is prime.
%  Let $\ring_{q'}$ be the polynomial ring $\defringqq$.
%Let $H\colon\, \bin^* \to \tern_{\alpha_H}$ be a hash function.
%  Then $\otschip$ as in \autoref{fig:otsconstruction} is a individually correct one time signature scheme.
%\end{lemma}
%\begin{proof}
%  Let $\params \gets \setup(\secparam)$, $(\osk,\opk) \gets \kgen(\params)$, $m\in\bin^*$ and $\vec{\sigma} \gets \sign(\params,\osk,m)$ be arbitrary.
%  We first observe that the check on the \emph{value} of the signature goes through, as
%  \begin{align*}
%    \vec{a}^\transpose\vec{\sigma}
%    ={}&\vec{a}^\transpose(\vec{s}_0\cdot H(m) + \vec{s}_1)\tag{Def. of $\sign$}\\
%    ={}&\vec{a}^\transpose\vec{s}_0\cdot H(m) + \vec{a}^\transpose\vec{s}_1 \tag{Distributivity}\\
%    ={}&v_0\cdot H(m) + v_1. \tag{Def. of $\kgen$}
%  \end{align*}
%  The signature also does not violate the norm bound, as
%  \begin{align*}
%    \norm{\vec{\sigma}}
%    ={}&\norm{\vec{s}_0\cdot H(m) + \vec{s}_1} \tag{Def. of $\sign$}\\
%    \leq{}&\norm{\vec{s}_0\cdot H(m)} + \norm{\vec{s}_1}\\
%    \leq{}&\norm{\vec{s}_0}\cdot\norm{H(m)}_1 + \norm{\vec{s}_1} \tag{\autoref{lem:ternbound}}\\
%    ={}&2\varphi\alpha_H \tag{Def. of $\kgen$}.
%  \end{align*}
%  The lemma thus follows.
%  \qed
%\end{proof}


%\begin{lemma}\label{lem:kots_correct}
%Let $\secpar, \alpha_w$, $\alpha_H$, $\varphi$, $\otspkkeylen$, $\rho$, $\beta_\sigma$, $n$, $q'$ be positive integers and $0 < \errorbound < 1$, such that 
%\[
%\beta_\sigma \geq 4\varphi\alpha_H\sqrt{\tfrac{1}{2}\alpha_w\rho \cdot \ln\tfrac{2n\otspkkeylen}{\errorbound}} \enspace.
%\]
%  Let $\ring_{q'}$ be the polynomial ring $\defringqq$.
%  Let $H\colon\, \bin^* \to \tern_{\alpha_H}$ be a hash function.
%  Then $\otschip$ as in \autoref{fig:otsconstruction} is a $(\rho,\tern_{\alpha_w},\varepsilon)$-probabilistically homomorphic one time signature scheme.
%\end{lemma}

%\begin{proof}
%  Let $\ell\in[\rho]$, $m\in\bin^*$, and $\params\gets\setup(\secparam)$ and for $i\in[\ell]$ let $\opk^i=(v_0,v_1) \in \ring_{q'}^2$ and $\vec{\sigma}^i \in \ring_{q'}^\otspkkeylen$ be arbitrary such that for all $i\in[\ell]$, $\iverify(\params,\opk^i,m,\vec{\sigma}^i)=1$.
%  
%  We first note that even for arbitrary $w_1,\dots,w_\ell \in \tern_\alpha$ it holds that
%  \begin{align*}
%    \vec{a}^\transpose\cdot \sum_{i=1}^{\ell-1}w^i\cdot\vec{\sigma}^i
%    ={}&\sum_{i=1}^{\ell}w^i\cdot\vec{a}^\transpose\vec{\sigma}^i \tag{Distributivity}\\
%    ={}&\sum_{i=1}^{\ell}w^i\cdot(v^i_0\cdot H(m)+v^i_1) \tag{Def. of $\iverify$}\\
%%    ={}&\sum_{i=1}^{\ell}w^iv^i_0\cdot H(m)+ \sum_{i=1}^{\ell}w^iv^i_1 \tag{Distributivity}\\
%    ={}&\Bigl(\sum_{i=1}^{\ell}w^iv^i_0\Bigr)\cdot H(m)+ \Bigl(\sum_{i=1}^{\ell}w^iv^i_1\Bigr) \tag{Distributivity}.
%  \end{align*}
%  Therefore, it only remains to verify that the norm-check goes through with sufficient probability.
%  That means we need to show that
%  \[
%    P\coloneqq \Pr\mleft[
%      w^1,\dots,w^\ell\gets \tern_{\alpha_w}
%      \colon
%      \Bigl\Vert\sum_{i=1}^{\ell} w^i\cdot\vec{\sigma}^i\Bigr\Vert > \beta_\sigma\mright] \leq \errorbound \enspace.
%  \]
%  For each individual $\vec{\sigma}^i$, it holds by the definition of $\iverify$ that $\norm{\vec{\sigma}^i} \leq 2\varphi\alpha_H$.
%  What we need show here is a norm bound in $\ring^\otspkkeylen$, i.e. the bound holds even if we do not reduce modulo $q'$.
%  Using \autoref{lem:normgrowth} with $\zeta = \tfrac{\beta_\sigma}{2\varphi\alpha_H}$ and taking a union bound over all $\otspkkeylen$ entries immediately gives
%  \begin{align}\label{eq:appliedMcD}
%   P \leq \otspkkeylen\cdot 2n\exp\Bigl(-\frac{\beta_\sigma^2}{8\varphi^2\alpha_H^2\alpha_w\ell}\Bigr) \leq 2\otspkkeylen n\exp\Bigl(-\frac{\beta_\sigma^2}{8\varphi^2\alpha_H^2\alpha_w\rho}\Bigr)\enspace.
%  \end{align}
%Our condition $\beta_\sigma \geq 4\varphi\alpha_H\sqrt{\tfrac{1}{2}\alpha_w\rho \cdot \ln\tfrac{2n\otspkkeylen}{\errorbound}}$ is chosen as to be equivalent to
%\[
% \frac{\beta_\sigma^2}{8\varphi^2\alpha^2_H\alpha_w\rho} \geq \ln\Bigl( \frac{2\otspkkeylen n}{\errorbound} \Bigr)\enspace.
%\]
%Plugging this into \autoref{eq:appliedMcD} directly gives $P \leq \errorbound$.
%%   To bound this probability, consider that the norm-bound is violated iff the absolute value of at least one of the $n\otspkkeylen$ coefficients in $\sum_{i=1}^{\ell} w^i\cdot\vec{\sigma}^i$ is greater than $\beta_\sigma$.
%%   By a union bound it is thus sufficient to show that each individual coefficient violates the bound with probability at most $2^{-\varepsilon}/(n\otspkkeylen)$
%%   
%%   For each individual $\vec{\sigma}^i$ it holds by the definition of $\iverify$ that
%%     $\norm{\vec{\sigma}^i} \leq 2\varphi\alpha_H$
%%   Therefore, each coefficient is a sum of the form
%%   \(
%%     \sum_{j=1}^{\alpha_w\ell}b_j c_j
%%   \)
%%   where $\abs{c_j}\leq 2\varphi\alpha_H$ and $b_j$ is chosen uniformly from $\{-1,1\}$.
%%   By linearity of expectation, the expected value of this sum is always zero and changing any summand can vary the sum by at most $4\varphi\alpha_H$. We can thus apply McDiarmid's inequality~\cite{McDiarmid89} and the lower bound on $\beta_\sigma$ from the lemma statement to obtain the following bound on the probability that each individual coefficient exceeds the norm bound $\beta_\sigma$:
%%   \begin{align*}
%%     \Pr\Bigl[\vec{b}\gets\{-1,1\}^{\alpha_w\ell} : \Bigl|\smashoperator{\sum_{j=1}^{\alpha_w\ell}}b_j c_j\Bigr| > \beta_\sigma\Bigr]
%%     \leq{}& 2\cdot\exp\Bigl(-\frac{2\beta_\sigma^2}{\alpha_w\ell\cdot (4\varphi\alpha_H)^2}\Bigr)\\
%%     \leq{}& 2\cdot\exp\Bigl(-\frac{2\beta_\sigma^2}{\alpha_w\rho\cdot (4\varphi\alpha_H)^2}\Bigr)\\
%%     \leq{}& 2\cdot\exp\Bigl(-\frac{2(4\varphi\alpha_H)^2\cdot\tfrac{1}{2}\alpha_w\rho(\varepsilon+1+\log_2n\otspkkeylen)\cdot\ln2}{\alpha_w\rho\cdot (4\varphi\alpha_H)^2}\Bigr)\\
%%     ={}& 2\cdot\exp(-(\varepsilon+1+\log_2n\otspkkeylen)\cdot\ln2)\\
%%     ={}& 2^{-\varepsilon-\log_2n\otspkkeylen} = 2^{-\varepsilon}\cdot \frac{1}{n\otspkkeylen}
%%   \end{align*}
%It thus follows that with probability at least $1-\errorbound$ the strong verification algorithm outputs $1$ as required.
%\end{proof}


%\begin{lemma}\label{lem:kots_homomorphic}
%  Let $\secpar, \alpha_H$, $\varphi$, $\otspkkeylen$, $\beta_\sigma,q',n$ be positive integers.
%  As usual, let $\ring_{q'}$ be the polynomial ring $\defringqq$.
%  Let $H\colon\, \bin^* \to \tern_{\alpha_H}$ be a hash function.
%  Then $\otschip$ as in \autoref{fig:otsconstruction} is robustly homomorphic.
%\end{lemma}

%\begin{proof}
%  Let $\params\gets\setup(\secparam)$, let $m\in\bin^*$, let $\opk^0=(v^0_0,v^0_1),\allowbreak\opk^1=(v^1_0,v^1_1)\in \ring^2_q$, and let $\vec{\sigma}^0,\vec{\sigma}^1 \in \ring_{q'}^\otspkkeylen$ be arbitrary such that both $\sverify(\params,\opk^0,m,\vec{\sigma}^0)=1$ and $\sverify(\params,\opk^1,m,\vec{\sigma}^1)=1$.
%  
%  By the definition of the strong verification algorithm, it holds that
%  \begin{equation*}
%     \norm{(\vec{\sigma}^0-\vec{\sigma}^1)}
%    \leq \norm{\vec{\sigma}^0}+\norm{\vec{\sigma}^1}
%    \leq 2\beta_\sigma\enspace,
%  \end{equation*}
%  thus the norm check goes through.
%  It remains to verify that the second check also goes through.
%  Using the definition of $\sverify$, it holds that
%  \begin{align*}
%     \vec{a}^\transpose\cdot (\vec{\sigma}^0-\vec{\sigma}^1)
%    ={}& \vec{a}^\transpose\cdot \vec{\sigma}^0- \vec{a}^\transpose\cdot\vec{\sigma}^1\\
%    ={}& (v^0_0\cdot H(m) + v^0_1) - (v^1_0\cdot H(m) + v^1_1)\\
%    ={}& (v^0_0-v^1_0)\cdot H(m) + (v^0_1-v^1_1)\enspace.
%  \end{align*}
%  Therefore, the lemma statement follows.
%\end{proof}


%\begin{lemma}\label{lem:kots_sis}
%  Let $n,\otspkkeylen,q',\alpha_H,\alpha_w,\secpar$ be positive integers with $q'$ prime and $n$ a power of two, with $q' > 16 \alpha_w \alpha_H\varphi$.
%%   $\otspkkeylen\geq((3\secpar+\delta)/n+\log_2q)\log^{-1}_2(\varphi+\tfrac{1}{2})$, and $2^{2\secpar} \leq \abs{\tern_{\alpha_H}} \leq 2^{2\secpar + \delta}$.
%  Let $H\colon\, \bin^* \to \tern_{\alpha_H}$ be a hash function.
%  If the $\sis_{\ring,q',\otspkkeylen,2\beta_\sigma + 4\alpha_w\alpha_H\varphi}$ problem is hard and $H$ is collision resistant, then $\otschip$ as in \autoref{fig:otsconstruction} is existentially unforgeable under rerandomized keys.
%\end{lemma}

%\begin{proof}
%  Let $\adv$ be an arbitrary adversary against the multi-user $W'$-existentially unforgeability under rerandomized keys with success probability $\nu(\secpar)$.
%  We construct an algorithm $\sisadvkots$ that solves $\sis_{\ring,q',\otspkkeylen,2\beta_\sigma + 4\alpha_w\alpha_H\varphi}$ as follows.
%  Given $\vec{a}\in\ring_{q'}^\otspkkeylen$, $\sisadvkots$ honestly chooses secret keys $(\vec{s}^i_0,\vec{s}^i_1) \in \ball{\varphi}{q'}^\otspkkeylen\times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$ uniformly at random for $i\in[T]$ and invokes $\adv$ on public keys $(v^i_0,v^i_1)$, with $v^i_b := \vec{a}^\transpose\cdot s^i_b$.
%  Whenever $\adv$ sends a signing query $(i,m)$, $\sisadvkots$ will respond with the honestly computed signature $\vec{\sigma}:=\vec{s}^i_0\cdot H(m)+ \vec{s}^i_1$.
%  Eventually $\adv$ outputs a candidate forgery $(i^*,m^*,\vec{\sigma}^*,w^*)$ and $\sisadvkots$ will compute a signature on the same message as $\vec{\sigma}' := w^*\cdot\vec{s}^{i^*}_0\cdot H(m^*)+ w^*\cdot\vec{s}^{i^*}_1$.
%  It then outputs $\vec{\sigma}^*-\vec{\sigma}'$.
%  
%  To analyze the success probability of $\sisadvkots$ suppose that $\adv$ outputs a \emph{valid} forgery.
%  I.e., at most a single query was asked for index $i^*$, said query was \emph{not} $m^*$, $w^*\in W'$ and $\wverify(\vec{a},(w^*v^{i^*}_0,w^*v^{i^*}_1),m^*,\allowbreak\vec{\sigma}^*)=1$.
%  From this and the definition of $\vec{\sigma}'$ above it follows that
%  \begin{align*}
%       \vec{a}^\transpose\cdot(\vec{\sigma}^*-\vec{\sigma}') ={}& \vec{a}^\transpose\vec{\sigma}^*-\vec{a}^\transpose\vec{\sigma}'\\ 
%    ={}& (w^*\cdot v^{i^*}_0 H(m) + w^*\cdot v^{i^*}_1) \\
%    - {}&\vec{a}^\transpose(w^*\cdot \vec{s}^{i^*}_0\cdot H(m^*)+ w^*\cdot\vec{s}^{i^*}_1)\\
%    ={}& (w^*\cdot v^{i^*}_0 H(m) + w^*\cdot v^{i^*}_1) \\
%    -{}& (w^*\cdot\vec{a}^\transpose\vec{s}^{i^*}_0\cdot H(m^*)+ w^*\cdot\vec{a}^\transpose\vec{s}^{i^*}_1)\\
%    ={}& (w^*\cdot v^{i^*}_0\cdot H(m) + w^*\cdot v^{i^*}_1)\\
%    -{}& (w^*\cdot v^{i^*}_0\cdot H(m) + w^*\cdot v^{i^*}_1) = 0.
%  \end{align*}
%  as required for a solution to the SIS problem.
%  
%  Next, to argue that $\norm{\vec{\sigma}^*-\vec{\sigma}'}\leq 2\beta_\sigma + 4\alpha_w\alpha_H\varphi$, note that the weak verification algorithm guarantees that $\norm{\vec{\sigma}^*} \leq 2\beta_\sigma$.
%  Further, since $w^*\in W'$ there exist $w_0,w_1 \in \tern_{\alpha_w}$ such that $w^* = w_0-w_1$ and $\norm{w^*}_1 \leq \norm{w_0}_1 + \norm{w_1}_1 = 2\alpha_w$.
%  We can thus, using the definition of $\sign$, the triangle inequality, and \autoref{lem:ternbound}, bound the norm of $\vec{\sigma}'$ as
%  \begin{align*}
%    \lVert{\vec{\sigma}'}\rVert ={}& \lVert{w^*\cdot\vec{s}^{i^*}_0\cdot H(m^*)+ w^*\cdot\vec{s}^{i^*}_1}\rVert\\
%    ={}&\lVert{w^*\cdot\vec{s}^{i^*}_0\cdot H(m^*)}\rVert+ \lVert{w^*\cdot\vec{s}^{i^*}_1}\rVert\\
%    ={}&\lVert{w^*}\rVert_1\cdot\lVert{H(m^*)}\rVert_1\cdot\lVert{\vec{s}^{i^*}_0}\rVert + \lVert{w^*}\rVert_1\cdot\lVert{\vec{s}^{i^*}_1}\rVert\\
%    ={}&4\alpha_w\alpha_H\varphi\enspace.\tag{$w^*\in W'$ and $H(m^*)\in\tern_{\alpha_H}$}
%  \end{align*}
%  It follows that $\norm{\vec{\sigma}^*-\vec{\sigma}'} \leq \norm{\vec{\sigma}^*}+\norm{\vec{\sigma}'} \leq 2\beta_\sigma + 4\alpha_w\alpha_H\varphi$ as required.

%  Finally, we need to argue that $\vec{\sigma}^*-\vec{\sigma}'\neq 0$.
%  This is the case iff $\vec{\sigma}^* \neq \vec{\sigma}'$.
%  It thus suffices to bound the probability, that $\vec{\sigma}^*=\vec{\sigma}'$.

%  To this end, we observe by \autoref{lem:keyhidden} that, since $\adv$ has learned at most a single signature under $(v_0^{i^*},v_1^{i^*})$, the corresponding $(\vec{s}_0^{i^*},\allowbreak\vec{s}_1^{i^*})$ remains information-theoretically hidden from $\adv$ among at least 2 possible secret keys.
%  Once $\adv$ outputs a valid forgery $(i^*,m^*,\allowbreak\vec{\sigma}^*,w^*)$ the signing key used for the forgery becomes uniquely determined by \autoref{lem:nilssupportivechildsupport} as long as $H(m^*)\neq H(m)$ which is guaranteed with overwhelming probability by the collision resistance of $H$.
%  It follows that $\sigma^* \neq \sigma'$ with probability at least $1/2 - \negl$.
%  Therefore, the success probability of our reduction $\sisadvkots$ is $(1/2 - \negl) \nu(\secpar)$ and since the SIS problem is assumed to be hard, $\nu(\secpar)$ must therefore be negligible in $\secpar$.
%\end{proof}

%\begin{lemma}\label{lem:keyhidden}
%  Let $n,\otspkkeylen,q',\alpha_H, \varphi,\secpar$ be positive integers such that there exists $\delta$ with $\otspkkeylen\geq((3\secpar+\delta)/n+\log_2q)\log^{-1}_2(\varphi+\tfrac{1}{2})$ and $\abs{\tern_{\alpha_H}} \leq 2^{2\secpar + \delta}$, let $\ring_{q'}=\defringqq$.
%  Then for any $\vec{a}\in\ring_{q'}^\otspkkeylen$ and uniformly chosen $(\vec{s}_0,\vec{s}_1)\in \ball{\varphi}{q'}^\otspkkeylen \times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$ it holds with probability at least $1-2^{-\lambda}$ that
%  for every $c\in \tern_{\alpha_H}$ there exists $(\vec{s}'_0,\vec{s}'_1)\in \ball{\varphi}{q'}^\otspkkeylen \times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$such that $(\vec{s}'_0,\vec{s}'_1)\neq(\vec{s}_0,\vec{s}_1)$, $(\vec{a}^\transpose\cdot\vec{s}'_0,\vec{a}^\transpose\cdot\vec{s}'_1) = (\vec{a}^\transpose\cdot\vec{s}_0,\vec{a}^\transpose\cdot\vec{s}_1)$ and $\vec{s}'_0\cdot c + \vec{s}'_1 = \vec{s}_0\cdot c + \vec{s}_1$.
%\end{lemma}
%\begin{proof}
%  We define a function $f_{\vec{a}, c}$ that maps any secret key $(\vec{s}_0,\allowbreak \vec{s}_1)$ to a pair of public key and signature defined as $((\vec{a}^\transpose\cdot\vec{s}_0,\vec{a}^\transpose\cdot\vec{s}_1), \vec{s}_0\cdot c + \vec{s}_1)$.
%  We will show that the domain of this function is at least $2^{3\secpar + \delta}$ times larger than the range.
%  The number of possible secret keys is $(2\varphi+1)^{n\otspkkeylen} \cdot (2\varphi\alpha_H+1)^{n\otspkkeylen}$.
%  The number of possible signatures is at most $(4\varphi\alpha_H + 1)^{n\otspkkeylen}$.
%  For fixed values $\vec{a}, c, \vec{s}_0\cdot c + \vec{s}_1$, we observe that once $\vec{a}^\transpose\cdot\vec{s}_0$ is fixed, the second component $\vec{a}^\transpose\cdot\vec{s}_1 = \vec{a}^\transpose \cdot ((\vec{s}_0\cdot c + \vec{s}_1) - \vec{s}_0 \cdot c)$ is uniquely determined.
%  Thus for a fixed signature, there are at most $q'^n$ many possible public keys and therefore the size of the range of $f_{\vec{a}, c}$ is at most $(4 \varphi\alpha_H + 1)^{n\otspkkeylen} \cdot q'^n$.
%  We observe that
%  \begin{align*}\frac{(2\varphi+1)^{n\otspkkeylen} \cdot (2\varphi\alpha_H+1)^{n\otspkkeylen}}{(4 \varphi\alpha_H + 1)^{n\otspkkeylen} \cdot q'^n}
%   \geq{}& \frac{(2\varphi+1)^{n\otspkkeylen} \cdot (2\varphi\alpha_H+1)^{n\otspkkeylen}}{(4 \varphi\alpha_H + 2)^{n\otspkkeylen} \cdot q'^n}\\
%   ={}& \frac{(2\varphi+1)^{n\otspkkeylen}}{2^{n\otspkkeylen} \cdot q'^n}\\
%   ={}& \left(\varphi+\tfrac{1}{2}\right)^{n\otspkkeylen} \cdot \frac{1}{q'^n}\\
%   ={}& 2^{\log_2(\varphi+\frac{1}{2})\cdot{n\otspkkeylen} - n \log_2 q'}\enspace.
%  \end{align*}
%  Using the condition on $\otspkkeylen$ from the lemma statement, one can see that
%  \[
%    \log_2(\varphi+\tfrac{1}{2})\cdot{n\otspkkeylen} - n \log_2 q'
%    \geq n\bigl(\tfrac{3\secpar+\delta}{n}+\log_2q\bigr) - n \log_2 q' = 3\secpar+\delta
%  \]
%  and thus, as claimed the domain of $f_{\vec{a},c}$ is at least $2^{3\secpar + \delta}$ times larger than its range.
%  
%  Using Lemma 4.1 from~\cite{TCC:LyuMic08}, the probability, over a uniformly chosen secret key, that there exists $(\vec{s}'_0,\vec{s}'_1)\in \ball{1}{q'}^\otspkkeylen \times \ball{\beta_s}{q'}^\otspkkeylen$ such that $(\vec{s}'_0,\vec{s}'_1)\neq(\vec{s}_0,\vec{s}_1)$, $(\vec{a}^\transpose\cdot\vec{s}'_0,\vec{a}^\transpose\cdot\vec{s}'_1) = (\vec{a}^\transpose\cdot\vec{s}_0,\vec{a}^\transpose\cdot\vec{s}_1)$ and $\vec{s}'_0\cdot c + \vec{s}'_1 = \vec{s}_0\cdot c + \vec{s}_1$ is at least $1-2^{-3\secpar-\delta}$.
%  By union bounding over all possible hash values $c \in \tern_{\alpha_H}$ and observing that $\abs{\tern_{\alpha_H}} \leq 2^{2\secpar + \delta}$ the lemma statement follows.
%  \end{proof}

%\begin{lemma}\label{lem:nilssupportivechildsupport}
%Let $n,\otspkkeylen,q',\alpha_H, \alpha_w$ be positive integers with $q'$ prime and $n$ a power of two such that $q' > 16 \alpha_w \alpha_H\varphi$ and let $\ring_{q'}=\defringqq$.
%Let $\vec{a}\in\ring_{q'}^\otspkkeylen$, $c_0,c_1 \in \tern_{\alpha_{H}}$, $w_0, w_1 \in \tern_{\alpha_w}$, and $\sigma_0,\sigma_1 \in \ring$ be arbitrary ring elements such that $c_0\neq c_1$ and $w_0 \neq w_1$.
%Then there exists at most a single pair of vectors $(\vec{s}_0,\vec{s}_1)\in\ball{\varphi}{q'}^\otspkkeylen\times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$, such that
%    \[
%    \vec{s}_0\cdot c_0 + \vec{s}_1 = \sigma_0 \quad\text{and}\quad (w_0 - w_1) \cdot (\vec{s}_0\cdot c_1 + \vec{s}_1) = \sigma_1\enspace.
%    \]
%\end{lemma}
% \begin{proof}
%    Let $(\vec{s}_0, \vec{s}_1)\in\ball{\varphi}{q'}^\otspkkeylen\times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$ and let $(\vec{s}'_0, \vec{s}'_1)\in\ball{\varphi}{q'}^\otspkkeylen\times \ball{\varphi\alpha_H}{q'}^\otspkkeylen$ be two secret keys, such that 
%    \begin{equation}
%    \vec{s}_0\cdot c_0 + \vec{s}_1 = \vec{s}'_0\cdot c_0 + \vec{s}'_1 \implies (\vec{s}_0 - \vec{s}'_0)\cdot c_0 + (\vec{s}_1 - \vec{s}'_1) = 0 \label{hello}
%    \end{equation}
%    and 
%    \begin{equation}
%    \begin{aligned}
%    &(w_0 - w_1) \cdot (\vec{s}_0\cdot c_1 + \vec{s}_1) = (w_0 - w_1) \cdot (\vec{s}'_0\cdot c_1 + \vec{s}'_1)\\ \implies& (w_0 - w_1)((\vec{s}_0 - \vec{s}'_0)\cdot c_1 + (\vec{s}_1 - \vec{s}'_1)) = 0\enspace. \label{kitty}
%    \end{aligned}
%    \end{equation}
%    Equation~\ref{hello} implies that 
%    \[
%    (w_0 - w_1)((\vec{s}_0 - \vec{s}'_0)\cdot c_0 + (\vec{s}_1 - \vec{s}'_1)) = 0.
%    \]
%    Combined with Equation~\ref{kitty}, we get that in $\ring_{q'}$
%    \begin{equation}
%    (w_0 - w_1)(\vec{s}_0 - \vec{s}'_0) (c_0 - c_1)  = 0\enspace. \label{herekittykitty}
%    \end{equation}
%    Since $w_0,w_1\in\tern_{\alpha_w}$, $\vec{s}_0,\vec{s}'_0 \in \ball{\varphi}{q'}^\otspkkeylen$, and $c_0,c_1\in\tern_{\alpha_{H}}$, it holds by \autoref{lem:ternbound} that
%    \begin{align*}
%      &\norm{(w_0 - w_1)(\overline{\vec{s}}_0 - \overline{\vec{s}}'_0) (c_0 - c_1)} \\
%      \leq &\norm{w_0 - w_1}_1\cdot\norm{c_0 - c_1}_1\cdot \norm{(\overline{\vec{s}}_0 - \overline{\vec{s}}'_0)} \\
%      \leq& 8\alpha_w\alpha_H\varphi \leq \tfrac{q'-1}{2}\enspace,
%    \end{align*}
%    where $\overline{\vec{s}}_i\in\ring$ is the representative of $\vec{s}_i\in\ring_{q'}$ with coefficients in $\{-\tfrac{q'-1}{2},\ldots,+\tfrac{q'-1}{2}\}$.
%    Therefore \autoref{herekittykitty} also holds in $\ring$.
%    Since $w_0 \neq w_1$, $c_0 \neq c_1$, and $\ring$ is an integral domain, it follows that $\vec{s}_0 = \vec{s}'_0$.
%    By Equation~\ref{hello}, it must therefore hold that $(\vec{s}_0, \vec{s}_1) = (\vec{s}'_0, \vec{s}'_1)$.
%\end{proof}
